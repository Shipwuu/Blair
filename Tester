-- Creating a new ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BlairScreenGui"
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- Creating the main frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Parent = screenGui
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.Size = UDim2.new(0, 400, 0, 300)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainFrame.BorderSizePixel = 0

-- Adding a title
local titleLabel = Instance.new("TextLabel")
titleLabel.Parent = mainFrame
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.Size = UDim2.new(1, 0, 0, 50)
titleLabel.BackgroundTransparency = 1
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.Text = "Blair GUI"
titleLabel.TextSize = 24
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Adding buttons for actions
local function createButton(name, text, callback)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Parent = mainFrame
    button.Size = UDim2.new(0, 150, 0, 50)
    button.Position = UDim2.new(0.5, -75, 0, 60 + (#mainFrame:GetChildren() - 2) * 60)
    button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    button.BorderSizePixel = 0
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.SourceSans
    button.TextSize = 18
    button.Text = text

    button.MouseButton1Click:Connect(callback)
end

createButton("SanityCheckButton", "Sanity Check", function()
    local player = game:GetService("Players").LocalPlayer
    local sanity = player:FindFirstChild("Sanity")
    if sanity then
        game.StarterGui:SetCore("SendNotification", {
            Title = "Info",
            Text = "Sanity "..sanity.Value,
            Duration = 1.5
        })
    end
end)

createButton("TpToOuijaButton", "TpToOuija", function()
    game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.CFrame = game:GetService("Workspace")["Ouija Board"].Board.CFrame
end)

createButton("TpToGeneratorButton", "TpToGenerator", function()
    game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.CFrame = workspace.Map.Generators.GeneratorMesh.CFrame
end)

createButton("TpToVanButton", "TpToVan", function()
    game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.CFrame = workspace.Map.Van.SpawnLocation.CFrame
end)

-- Set up lighting and other environmental effects
game:GetService("Lighting").Brightness = 2
game:GetService("Lighting").ClockTime = 0
game:GetService("Lighting").FogEnd = 100000
game:GetService("Lighting").GlobalShadows = false
game:GetService("Lighting").OutdoorAmbient = Color3.fromRGB(128, 128, 128)

-- Adding Billboards to objects
local function addBillboard(name, parent, text, color)
    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = parent
    billboard.Name = name
    billboard.Size = UDim2.new(0, 100, 0, 150)
    billboard.StudsOffset = Vector3.new(0, 1, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = parent

    local textLabel = Instance.new("TextLabel")
    textLabel.Parent = billboard
    textLabel.BackgroundTransparency = 1
    textLabel.Position = UDim2.new(0, 0, 0, -50)
    textLabel.Size = UDim2.new(0, 100, 0, 100)
    textLabel.Font = Enum.Font.SourceSansSemibold
    textLabel.TextSize = 14
    textLabel.TextColor3 = color
    textLabel.TextStrokeTransparency = 0
    textLabel.TextYAlignment = Enum.TextYAlignment.Bottom
    textLabel.Text = text
    textLabel.ZIndex = 10
end

for _, obj in pairs(workspace.Map.OuijaSpawn:GetChildren()) do
    if obj.Name == "Ouija" then
        addBillboard("Ouija_Board", obj, "Ouija Board", Color3.fromRGB(0, 128, 0))
    end
end

for _, obj in pairs(workspace.Map.Generators:GetChildren()) do
    if obj.Name == "GeneratorMesh" then
        addBillboard("Generator", obj, "Generator", Color3.fromRGB(255, 0, 0))
    end
end

for _, obj in pairs(workspace.Map.Van:GetChildren()) do
    if obj.Name == "SpawnLocation" then
        addBillboard("Van", obj, "Van", Color3.fromRGB(255, 20, 147))
    end
end

-- Adding Orb and Print tracking
local currentCamera = workspace.CurrentCamera
local function trackObject(object, text, color)
    addBillboard("TrackingGui", object, text, color)
    local textLabel = object:FindFirstChild("TrackingGui"):FindFirstChildOfClass("TextLabel")
    
    local function updatePosition()
        local conn
        conn = game:GetService("RunService").RenderStepped:Connect(function()
            if object and object:IsDescendantOf(workspace) then
                local screenPos, onScreen = currentCamera:WorldToViewportPoint(object.Position)
                if onScreen then
                    textLabel.Position = Vector2.new(screenPos.X, screenPos.Y)
                    textLabel.Visible = true
                else
                    textLabel.Visible = false
                end
            else
                conn:Disconnect()
            end
        end)
    end

    coroutine.wrap(updatePosition)()
end

for _, obj in pairs(workspace.Map.Orbs:GetChildren()) do
    if obj.Name == "OrbPart" then
        trackObject(obj, "Orb", Color3.fromRGB(30, 144, 255))
    end
end

workspace.Map.Orbs.ChildAdded:Connect(function(child)
    if child.Name == "OrbPart" then
        trackObject(child, "Orb", Color3.fromRGB(30, 144, 255))
    end
end)

for _, obj in pairs(workspace.Map.Prints:GetChildren()) do
    if obj.Name == "PrintPart" then
        trackObject(obj, "Fingerprint", Color3.fromRGB(75, 0, 130))
    end
end

workspace.Map.Prints.ChildAdded:Connect(function(child)
    if child.Name == "PrintPart" then
        trackObject(child, "Fingerprint", Color3.fromRGB(75, 0, 130))
    end
end)
