-- Define necessary services and variables
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local HRoot = character:WaitForChild("HumanoidRootPart")

-- Check for existing button and destroy if found (to prevent duplication)
local playerGui = player:WaitForChild("PlayerGui")
local existingButtonGui = playerGui:FindFirstChild("EndButtonGui")
if existingButtonGui then
    existingButtonGui:Destroy()
end

-- Save the original position of the player
local OldPos = HRoot.CFrame

-- Function to interact with the ProximityPrompt at the specific path
local function findAndInteract()
    -- Find the specific ProximityPrompt path
    local lightSwitchParent = Workspace:FindFirstChild("Map"):FindFirstChild("Van"):FindFirstChild("Van"):FindFirstChild("LeaveButton"):FindFirstChild("LightSwitch")
    
    if lightSwitchParent then
        -- Get the 3rd child which is the proximity prompt in your path
        local proximityPrompt = lightSwitchParent:GetChildren()[3]
        
        if proximityPrompt and proximityPrompt:IsA("ProximityPrompt") then
            -- Interaction loop
            repeat
                pcall(function()
                    HRoot.CFrame = proximityPrompt.Parent.CFrame -- Move to the parent of the ProximityPrompt
                end)
                wait(0.2)
                pcall(function()
                    fireproximityprompt(proximityPrompt) -- Fire the proximity prompt
                    wait(3) -- Add a 3-second cooldown after interaction
                    HRoot.CFrame = OldPos -- Return to the original position
                end)
            until not proximityPrompt.Parent or not proximityPrompt or not lightSwitchParent:IsDescendantOf(Workspace)
        else
            warn("ProximityPrompt not found at the specified path or it is not a ProximityPrompt instance.")
        end
    else
        warn("LightSwitch path not found.")
    end
end

-- Create a ScreenGui for the button
local buttonGui = Instance.new("ScreenGui")
buttonGui.Name = "EndButtonGui"
buttonGui.Parent = playerGui
buttonGui.ResetOnSpawn = false

-- Create the button
local endButton = Instance.new("TextButton")
endButton.Name = "EndButton"
endButton.Parent = buttonGui
endButton.Size = UDim2.new(0, 140, 0, 60) -- Button size (140x60 pixels)
endButton.Position = UDim2.new(1, -289, 0, 220) -- Positioned just below the specified position
endButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0) -- Black background color
endButton.BackgroundTransparency = 0.8 -- Set transparency
endButton.Text = "End"
endButton.TextColor3 = Color3.new(1, 1, 1) -- White text color
endButton.Font = Enum.Font.SourceSansBold
endButton.TextScaled = true

-- Add UICorner to the button for rounded edges
local corner = Instance.new("UICorner")
corner.Parent = endButton

-- Connect button click to execute the function
endButton.MouseButton1Click:Connect(findAndInteract)
